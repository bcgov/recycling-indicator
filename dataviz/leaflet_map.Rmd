---
output:
  html_document:
    css: "assets/leaflet_style.css"
---


```{r echo = FALSE, include=params$draft, results='asis'}

knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)
library(leaflet)
library(sf)
library(geojsonio)
library(htmltools)
library(mapview)
library(DT)
library(rmapshaper)
library(viridis)

# SOE + popups
library(envreportutils)

# load data 


reg_dist <- read_rds("./data/reg_dist.rds") 
reg_dist <- reg_dist %>% 
   group_by(regional_district) %>%
   filter(year == "2017" )


```



# {.tabset .tabset-fade}

```{r grizz_map, warning=FALSE, echo=FALSE}
recmap <- leaflet(width = "900px", height = "600px", 
                    options = leafletOptions(minZoom = 5)) %>%  # generate leaflet map
  addProviderTiles(providers$Stamen.Terrain, group = "Terrain") %>%
  add_bc_home_button() %>%
  set_bc_view()

```

## Recycling Per Region 

```{r}
# define the map styling

palette1 <- colorNumeric(palette = 'viridis', reg_dist$n.kg.pop, reverse = TRUE)

# Define labels 
labels <- reg_dist$regional_district

# Popup figures 
trend_popups <- paste0("<img src = ", 
                        paste0("./trend_plots/", 
                               gsub("\\s+", "%20", reg_dist$regional_district), ".svg"), 
                        ">")
# set up popup list
#trend_popups <-  leafpop::popupGraph(region_plot_list, type = "svg")

# Define popup options
popup_options <-  popupOptions(maxWidth = 400, minWidth = 400, maxHeight = 300,
                               autoPan = TRUE,
                               keepInView = TRUE,
                               closeOnClick = TRUE,
                               autoPanPaddingTopLeft = c(120, 20),
                               autoPanPaddingBottomRight = c(150,20))

```


```{r echo=FALSE, message=FALSE}

recmap %>%
  addPolygons(data = reg_dist, group = "Regional Districts",
              stroke = T, weight = 1, color = "black",
              fillOpacity = 0.5,
              fillColor = ~ palette1(n.kg.pop),
              highlightOptions = highlightOptions(fillOpacity = 0.9,
                                                  weight = 3,
                                                  color = "yellow",
                                                  bringToFront = T),
              label = labels,
              labelOptions = labelOptions(direction = "auto",
                                          textsize = "12px"),
              popup = trend_popups,
              popupOptions = popup_options,
  ) %>%
   addLegend(position = "bottomleft", pal = palette1, values = reg_dist$n.kg.pop,
            title = htmltools::HTML("Recycled material<br/>kg per<br/>capita (2017)"),
            labFormat = labelFormat(suffix = , between = "", digits = 3))


```

Cum vivamus penatibus sed mus fringilla non sociosqu taciti ut. Sed, semper lacus justo ultricies penatibus praesent. Tortor vivamus fermentum libero, libero urna montes orci luctus ligula? Tellus et mauris sed a in lacinia imperdiet. Sed nec penatibus sed at mauris etiam. Interdum morbi arcu vitae lectus cubilia eros, imperdiet felis. Nisl, lacinia vel, nisl, rutrum ac, elementum felis. Dui ante eros ex mi, interdum velit accumsan sociosqu, tempus. Erat vulputate potenti nascetur. Malesuada, curabitur, leo himenaeos, molestie euismod sit. In vitae sollicitudin adipiscing commodo.

## References and Other Useful Links

* Link 1
* Link 2

## Data

\*By accessing these datasets, you agree to the licence associated with each file, as indicated in parentheses below.

* Data 1
* Data 2

----

Published and Available On-Line at Environmental Reporting BC (Month Year):  
[](http://www.env.gov.bc.ca/soe)

Email correspondence to: envreportbc@gov.bc.ca

Suggested Citation:  
Environmental Reporting BC. Year. Indicator Title. State of Environment Reporting, Ministry of Environment and Climate Change Strategy, British Columbia, Canada.
